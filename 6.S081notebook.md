# 6.S081notebook



## guidance

尽管大多数 C 程序从来不需要在指针和整数之间转换，但操作系统经常这样做。每当您看到涉及内存地址的添加时，询问自己是整数添加还是指针添加，并确保要添加的值是否适当相乘。

- 如果练习部分工作，请通过提交代码来检查进度。如果以后中断了某样东西，可以回滚到检查点，然后以较小的步骤前进。
- 如果测试失败，请确保了解代码失败的原因。插入打印语句，直到了解发生了什么。
- 您可能会发现，您的打印语句可能会产生许多输出，您想搜索;一种方法就是 `make qemu` inside of script，该脚本将所有控制台输出记录到一个文件中，然后您可以搜索该文件。别忘了退出脚本。
- 在许多情况下，打印语句就足够了，但有时能够单步调试 汇编代码或检查堆栈上的变量是有帮助的。若要将 gdb 与 xv6 一起使用，请在另一个窗口中运行 `make qemu-gdb`，在另一个窗口中运行`gdb`或 `riscv64-linux-gnu-gdb`，设置断点，后跟"c"（继续），xv6 将运行到断点。（有关[有用的 GDB 提示，请参阅](https://pdos.csail.mit.edu/6.828/2019/lec/gdb_slides.pdf)使用 GNU 调试器。
- 如果要查看编译器为内核生成的程序集，或者要了解特定内核地址的指令，请参阅 Makefile 在编译内核时生成的文件`kernel.asm`。（Makefile 还为所有用户程序生成 `.asm`。
- 如果内核panics死机，它会打印一条错误消息，列出程序计数器崩溃时的值;如果内核死机，它将打印一条错误消息，列出程序计数器在崩溃时的值。您可以搜索`kernel.asm`以找出程序计数器崩溃时在哪个函数中，也可以运行`addr2line -e kernel/kernel pc-value`（运行`man addr2line`详细信息）。如果要回溯，请使用 gdb 重新启动：在一个窗口中运行`make qemu-gdb`，在另一个窗口中运行 gdb（或 riscv64-linux-gnu-gdb），在panic中设置断点（"b panic"），后跟"c"（继续）。当内核到达断点时，键入"bt"以获得回溯。
- 如果您的内核挂起（例如，由于死锁）或无法进一步执行（例如，由于执行内核指令时由于页面错误page fault），您可以使用 gdb 来找出它的挂起位置。在一个窗口中运行"make qemu-gdb"，在另一个窗口中运行 gdb （riscv64-linux-gnu-gdb），后跟"c"（继续）。当内核似乎挂起时，在 qemu-gdb 窗口中点击 Ctrl-C 并键入"bt"以获得回溯backtrace。
- `qemu`具有一个"监视器"，允许您查询模拟计算机的状态。您可以通过键入 control - a c 来获取它（"c"用于控制台console）。一个特别有用的监视器命令是`info mem`用于打印页表的信息。您可能需要使用 `cpu` 命令来选择`info mem`查看哪个core的信息，或者您可以使用`make CPUS=1 qemu` 使只有一个内核。